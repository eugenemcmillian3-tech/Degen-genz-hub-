'use client';

import { useState } from 'react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { Copy, Share2, ExternalLink } from 'lucide-react';

interface AIOutputDisplayProps {
  output: string;
  featureType: string;
}

export function AIOutputDisplay({ output, featureType }: AIOutputDisplayProps): JSX.Element {
  const [copied, setCopied] = useState<boolean>(false);

  const handleCopy = async (): Promise<void> => {
    await navigator.clipboard.writeText(output);
    setCopied(true);
    setTimeout(() => setCopied(false), 2000);
  };

  const handleShareFarcaster = (): void => {
    const text = encodeURIComponent(output.substring(0, 280));
    window.open(`https://warpcast.com/~/compose?text=${text}`, '_blank');
  };

  const handleShareTwitter = (): void => {
    const text = encodeURIComponent(output.substring(0, 280));
    window.open(`https://twitter.com/intent/tweet?text=${text}`, '_blank');
  };

  let parsedOutput: Record<string, unknown> | null = null;
  let isJSON = false;

  try {
    parsedOutput = JSON.parse(output);
    isJSON = true;
  } catch {
    // Not JSON, display as plain text
  }

  return (
    <Card className="bg-gray-900/50 border-purple-500/30">
      <CardHeader>
        <div className="flex items-center justify-between">
          <CardTitle className="text-white">Generated Content</CardTitle>
          <Badge className="bg-purple-600">{featureType}</Badge>
        </div>
      </CardHeader>
      <CardContent className="space-y-4">
        <div className="max-h-96 overflow-y-auto p-4 bg-gray-800 rounded-lg border border-gray-700">
          {isJSON && parsedOutput ? (
            <div className="space-y-4">
              {Object.entries(parsedOutput).map(([key, value]) => (
                <div key={key}>
                  <p className="text-purple-400 font-semibold mb-2 capitalize">
                    {key.replace(/_/g, ' ')}:
                  </p>
                  {Array.isArray(value) ? (
                    <ul className="list-disc list-inside space-y-1 text-gray-300">
                      {value.map((item, idx) => (
                        <li key={idx} className="text-sm">
                          {typeof item === 'string' ? item : JSON.stringify(item)}
                        </li>
                      ))}
                    </ul>
                  ) : typeof value === 'object' && value !== null ? (
                    <pre className="text-sm text-gray-300 whitespace-pre-wrap">
                      {JSON.stringify(value, null, 2)}
                    </pre>
                  ) : (
                    <p className="text-gray-300 text-sm whitespace-pre-wrap">{String(value)}</p>
                  )}
                </div>
              ))}
            </div>
          ) : (
            <pre className="text-sm text-gray-200 whitespace-pre-wrap">{output}</pre>
          )}
        </div>

        <div className="flex flex-wrap gap-2">
          <Button
            onClick={handleCopy}
            className="flex-1 bg-purple-600 hover:bg-purple-700"
          >
            <Copy className="w-4 h-4 mr-2" />
            {copied ? 'Copied!' : 'Copy All'}
          </Button>
          <Button
            onClick={handleShareFarcaster}
            className="flex-1 bg-purple-700 hover:bg-purple-800"
          >
            <Share2 className="w-4 h-4 mr-2" />
            Share to Farcaster
          </Button>
          <Button
            onClick={handleShareTwitter}
            variant="outline"
            className="flex-1 border-gray-700 hover:bg-gray-800"
          >
            <ExternalLink className="w-4 h-4 mr-2" />
            Share to Twitter
          </Button>
        </div>

        {isJSON && parsedOutput && (parsedOutput.castHooks || parsedOutput.farcasterCasts) && (
          <Card className="bg-gray-800/50 border-gray-700">
            <CardHeader>
              <CardTitle className="text-white text-sm">ðŸ“± Ready for Farcaster</CardTitle>
            </CardHeader>
            <CardContent>
              <p className="text-gray-400 text-xs">
                Your content is formatted and ready to share on Farcaster! Click the Share button above.
              </p>
            </CardContent>
          </Card>
        )}
      </CardContent>
    </Card>
  );
}
